{"ast":null,"code":"var _jsxFileName = \"/Users/vishnuvamsithyejju/Downloads/Disaster_Management-master/client/src/components/Alert.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport customMarkerIconImage from '../../src/assets/home/mark.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Popup() {\n  _s();\n\n  const [isOpen, setIsOpen] = useState(true);\n  const [isSending, setIsSending] = useState(false);\n  const [userLocation, setUserLocation] = useState(null);\n  const [nearbySafePlaces, setNearbySafePlaces] = useState([]);\n  const [isRequestingHelp, setIsRequestingHelp] = useState(false);\n  const [emergencyType, setEmergencyType] = useState('');\n  const [mapInitialized, setMapInitialized] = useState(false);\n  useEffect(() => {\n    const popupTimeout = setTimeout(() => {\n      setIsOpen(false);\n    }, 10000); // Close popup after 10 seconds\n\n    return () => clearTimeout(popupTimeout);\n  }, []);\n  useEffect(() => {\n    console.log('Initializing map');\n    let map;\n\n    if (mapInitialized) {\n      console.log('Map is being set up');\n\n      if (!window.myMap) {\n        map = L.map('map', {\n          center: userLocation ? [userLocation.latitude, userLocation.longitude] : [17.46821, 78.373056],\n          zoom: 13\n        });\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          maxZoom: 19,\n          attribution: 'Â© OpenStreetMap'\n        }).addTo(map);\n        window.myMap = map;\n        console.log('Map created');\n      } else {\n        map = window.myMap;\n        console.log('Using existing map');\n        map.eachLayer(layer => {\n          if (layer instanceof L.Marker) {\n            map.removeLayer(layer);\n            console.log('Removed old marker');\n          }\n        });\n      }\n\n      nearbySafePlaces.forEach(place => {\n        L.marker([place.latitude, place.longitude], {\n          icon: new L.Icon({\n            iconUrl: customMarkerIconImage,\n            iconSize: [25, 41],\n            iconAnchor: [12, 41],\n            popupAnchor: [1, -34]\n          })\n        }).addTo(map).bindPopup(`<b>${place.Name}</b>`).openPopup();\n        console.log(`Added marker for ${place.Name}`);\n      });\n    }\n\n    return () => {\n      if (map) {\n        map.off();\n        map.remove();\n        window.myMap = null;\n        console.log('Map cleaned up');\n      }\n    };\n  }, [mapInitialized, nearbySafePlaces, userLocation]);\n\n  const handleClose = () => {\n    setIsOpen(false);\n  };\n\n  const handleEmergencyClick = () => {\n    setIsSending(true);\n    navigator.geolocation.getCurrentPosition(async position => {\n      const {\n        latitude,\n        longitude\n      } = position.coords;\n\n      try {\n        const response = await axios.post('http://localhost:5002/emergency/Location', {\n          latitude,\n          longitude,\n          emergencyType\n        });\n        console.log('Emergency location sent:', response.data.message);\n      } catch (error) {\n        console.error('Error sending emergency location:', error);\n      } finally {\n        setIsSending(false);\n      }\n    }, error => {\n      console.error('Geolocation error:', error);\n      setIsSending(false);\n    });\n  };\n\n  const handleHelpRequest = () => {\n    setIsRequestingHelp(true);\n    setIsSending(true);\n    navigator.geolocation.getCurrentPosition(async position => {\n      const {\n        latitude,\n        longitude\n      } = position.coords;\n      console.log(latitude);\n      setUserLocation({\n        latitude,\n        longitude\n      });\n\n      try {\n        const response = await axios.get(`http://localhost:8086/alert/nearby-safe-places`, {\n          params: {\n            userLat: latitude,\n            userLon: longitude\n          }\n        });\n        console.log(response.data.nearbySafePlaces);\n        setNearbySafePlaces(response.data.nearbySafePlaces);\n        setMapInitialized(true);\n      } catch (error) {\n        console.error('Error fetching nearby safe places:', error);\n      } finally {\n        setIsSending(false);\n        setIsRequestingHelp(false);\n      }\n    }, error => {\n      console.error('Geolocation error:', error);\n      setIsRequestingHelp(false);\n    });\n  };\n\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      zIndex: 9999\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        backgroundColor: '#fff',\n        padding: '20px',\n        boxShadow: '0 4px 8px 0 rgba(0, 0, 0, 0.2)',\n        textAlign: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          position: 'absolute',\n          top: '10px',\n          right: '10px',\n          fontSize: '24px',\n          cursor: 'pointer'\n        },\n        onClick: handleClose,\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"WELCOME TO DISASTER RESILIENCE!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Type of Emergency\",\n        value: emergencyType,\n        onChange: e => setEmergencyType(e.target.value),\n        style: {\n          margin: '10px 0'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleEmergencyClick,\n        disabled: isSending,\n        style: {\n          backgroundColor: 'red',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '5px',\n          padding: '10px 20px',\n          cursor: 'pointer'\n        },\n        children: isSending ? 'Sending...' : 'EMERGENCY'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleHelpRequest,\n        disabled: isSending,\n        style: {\n          backgroundColor: 'blue',\n          color: '#fff',\n          padding: '10px 20px',\n          margin: '10px',\n          cursor: 'pointer'\n        },\n        children: \"Request Help\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this), mapInitialized && /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        style: {\n          height: '400px',\n          width: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 28\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Popup, \"WiTFyBhkaZm3NkP/t6tDeVH+IpM=\");\n\n_c = Popup;\nexport default Popup;\n\nvar _c;\n\n$RefreshReg$(_c, \"Popup\");","map":{"version":3,"sources":["/Users/vishnuvamsithyejju/Downloads/Disaster_Management-master/client/src/components/Alert.jsx"],"names":["React","useState","useEffect","axios","L","customMarkerIconImage","Popup","isOpen","setIsOpen","isSending","setIsSending","userLocation","setUserLocation","nearbySafePlaces","setNearbySafePlaces","isRequestingHelp","setIsRequestingHelp","emergencyType","setEmergencyType","mapInitialized","setMapInitialized","popupTimeout","setTimeout","clearTimeout","console","log","map","window","myMap","center","latitude","longitude","zoom","tileLayer","maxZoom","attribution","addTo","eachLayer","layer","Marker","removeLayer","forEach","place","marker","icon","Icon","iconUrl","iconSize","iconAnchor","popupAnchor","bindPopup","Name","openPopup","off","remove","handleClose","handleEmergencyClick","navigator","geolocation","getCurrentPosition","position","coords","response","post","data","message","error","handleHelpRequest","get","params","userLat","userLon","display","justifyContent","alignItems","top","left","width","height","backgroundColor","zIndex","padding","boxShadow","textAlign","right","fontSize","cursor","e","target","value","margin","color","border","borderRadius"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\nimport customMarkerIconImage from '../../src/assets/home/mark.png';\n\nfunction Popup() {\n  const [isOpen, setIsOpen] = useState(true);\n  const [isSending, setIsSending] = useState(false);\n  const [userLocation, setUserLocation] = useState(null);\n  const [nearbySafePlaces, setNearbySafePlaces] = useState([]);\n  const [isRequestingHelp, setIsRequestingHelp] = useState(false);\n  const [emergencyType, setEmergencyType] = useState('');\n  const [mapInitialized, setMapInitialized] = useState(false);\n\n  useEffect(() => {\n    const popupTimeout = setTimeout(() => {\n      setIsOpen(false);\n    }, 10000); // Close popup after 10 seconds\n\n    return () => clearTimeout(popupTimeout);\n  }, []);\n\n  useEffect(() => {\n    console.log('Initializing map');\n    let map;\n  \n    if (mapInitialized) {\n      console.log('Map is being set up');\n      if (!window.myMap) {\n        map = L.map('map', {\n          center: userLocation ? [userLocation.latitude, userLocation.longitude] : [17.46821, 78.373056],\n          zoom: 13,\n        });\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          maxZoom: 19,\n          attribution: 'Â© OpenStreetMap'\n        }).addTo(map);\n        window.myMap = map;\n        console.log('Map created');\n      } else {\n        map = window.myMap;\n        console.log('Using existing map');\n        map.eachLayer((layer) => {\n          if (layer instanceof L.Marker) {\n            map.removeLayer(layer);\n            console.log('Removed old marker');\n          }\n        });\n      }\n  \n      nearbySafePlaces.forEach(place => {\n        L.marker([place.latitude, place.longitude], {\n          icon: new L.Icon({\n            iconUrl: customMarkerIconImage,\n            iconSize: [25, 41],\n            iconAnchor: [12, 41],\n            popupAnchor: [1, -34]\n          })\n        }).addTo(map)\n        .bindPopup(`<b>${place.Name}</b>`)\n        .openPopup();\n        console.log(`Added marker for ${place.Name}`);\n      });\n    }\n  \n    return () => {\n      if (map) {\n        map.off();\n        map.remove();\n        window.myMap = null;\n        console.log('Map cleaned up');\n      }\n    };\n  }, [mapInitialized, nearbySafePlaces, userLocation]);\n  \n\n  const handleClose = () => {\n    setIsOpen(false);\n  };\n\n  const handleEmergencyClick = () => {\n    setIsSending(true);\n    navigator.geolocation.getCurrentPosition(async (position) => {\n      const { latitude, longitude } = position.coords;\n      try {\n        const response = await axios.post('http://localhost:5002/emergency/Location', {\n          latitude,\n          longitude,\n          emergencyType,\n        });\n        console.log('Emergency location sent:', response.data.message);\n      } catch (error) {\n        console.error('Error sending emergency location:', error);\n      } finally {\n        setIsSending(false);\n      }\n    }, (error) => {\n      console.error('Geolocation error:', error);\n      setIsSending(false);\n    });\n  };\n\n  const handleHelpRequest = () => {\n    setIsRequestingHelp(true);\n    setIsSending(true);\n    navigator.geolocation.getCurrentPosition(async (position) => {\n      const { latitude, longitude } = position.coords;\n      console.log(latitude)\n      setUserLocation({ latitude, longitude });\n      try {\n        const response = await axios.get(`http://localhost:8086/alert/nearby-safe-places`, {\n          params: { userLat: latitude, userLon: longitude }\n        });\n        console.log(response.data.nearbySafePlaces)\n        setNearbySafePlaces(response.data.nearbySafePlaces);\n        setMapInitialized(true);\n      } catch (error) {\n        console.error('Error fetching nearby safe places:', error);\n      } finally {\n        setIsSending(false);\n        setIsRequestingHelp(false);\n      }\n    }, (error) => {\n      console.error('Geolocation error:', error);\n      setIsRequestingHelp(false);\n    });\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div style={{\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      zIndex: 9999,\n    }}>\n      <div style={{\n        backgroundColor: '#fff',\n        padding: '20px',\n        boxShadow: '0 4px 8px 0 rgba(0, 0, 0, 0.2)',\n        textAlign: 'center',\n      }}>\n        <span style={{\n          position: 'absolute',\n          top: '10px',\n          right: '10px',\n          fontSize: '24px',\n          cursor: 'pointer',\n        }} onClick={handleClose}>&times;</span>\n        <h1>WELCOME TO DISASTER RESILIENCE!</h1>\n        <input\n          type=\"text\"\n          placeholder=\"Type of Emergency\"\n          value={emergencyType}\n          onChange={(e) => setEmergencyType(e.target.value)}\n          style={{ margin: '10px 0' }}\n        />\n        <button onClick={handleEmergencyClick} disabled={isSending} style={{\n          backgroundColor: 'red',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '5px',\n          padding: '10px 20px',\n          cursor: 'pointer',\n        }}>\n          {isSending ? 'Sending...' : 'EMERGENCY'}\n        </button>\n        <button onClick={handleHelpRequest} disabled={isSending} style={{\n          backgroundColor: 'blue',\n          color: '#fff',\n          padding: '10px 20px',\n          margin: '10px',\n          cursor: 'pointer',\n        }}>\n          Request Help\n        </button>\n        {mapInitialized && <div id=\"map\" style={{ height: '400px', width: '100%' }}></div>}\n      </div>\n    </div>\n  );\n}\n\nexport default Popup;\n"]},"metadata":{},"sourceType":"module"}